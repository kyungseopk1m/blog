---
import { getCollection } from 'astro:content';
import Layout from '@layouts/Layout.astro';
import Header from '@components/layout/Header.astro';
import Footer from '@components/layout/Footer.astro';
import CategoryFilter from '@components/archive/CategoryFilter.astro';
import Timeline from '@components/archive/Timeline.astro';

const allPosts = await getCollection('posts', ({ data }) => !data.draft);
const sortedPosts = allPosts.sort(
  (a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf()
);

// Get unique categories
const categories = Array.from(
  new Set(allPosts.map((post) => post.data.category))
).sort();
---

<Layout title="Archive" description="모든 포스트 아카이브">
  <Header />
  <main class="flex-1 py-8 sm:py-12">
    <section class="mb-10">
      <h1 class="text-3xl sm:text-4xl font-bold mb-2 text-center">
        Archive
      </h1>
      <p class="text-center text-slate-600 dark:text-zinc-400 mb-8">
        전체 {sortedPosts.length}개의 포스트
      </p>
      <CategoryFilter categories={categories} />
    </section>

    <section>
      <Timeline posts={sortedPosts} />
    </section>
  </main>
  <Footer />
</Layout>
