---
const pathname = Astro.url.pathname;

const navs = [
  {
    href: '/about',
    label: 'About',
  },
  {
    href: '/archive',
    label: 'Archive',
  },
];
---

<header class="mt-4 sm:mt-6 flex flex-row items-center">
  <div class="mr-auto flex items-center gap-3">
    <a
      href="/"
      class="select-none text-xl sm:text-2xl font-semibold font-mono transition-colors hover:opacity-70"
      style="color: var(--color-accent);"
    >
      Bask
    </a>
    <button
      id="theme-toggle"
      class="text-sm sm:text-base transition-colors hover:opacity-70 cursor-pointer"
      aria-label="테마 변경"
    >
      <!-- 해 아이콘 (라이트모드일 때 표시) -->
      <svg id="sun-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="theme-icon hidden">
        <circle cx="12" cy="12" r="4"></circle>
        <path d="M12 2v2"></path>
        <path d="M12 20v2"></path>
        <path d="m4.93 4.93 1.41 1.41"></path>
        <path d="m17.66 17.66 1.41 1.41"></path>
        <path d="M2 12h2"></path>
        <path d="M20 12h2"></path>
        <path d="m6.34 17.66-1.41 1.41"></path>
        <path d="m19.07 4.93-1.41 1.41"></path>
      </svg>
      <!-- 달 아이콘 (다크모드일 때 표시) -->
      <svg id="moon-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="theme-icon hidden">
        <path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"></path>
      </svg>
    </button>
  </div>
  <nav class="flex flex-row items-center space-x-4">
    {
      navs.map((nav) => (
        <a
          href={nav.href}
          class:list={[
            'text-sm sm:text-base transition-colors hover:opacity-70',
            { 'font-semibold': nav.href === pathname },
          ]}
          style={nav.href === pathname ? 'color: var(--color-accent);' : ''}
        >
          {nav.label}
        </a>
      ))
    }
    <button
      id="search-btn"
      class="text-sm sm:text-base transition-colors hover:opacity-70 cursor-pointer"
      aria-label="검색"
    >
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="search-icon">
        <circle cx="11" cy="11" r="8"></circle>
        <path d="m21 21-4.35-4.35"></path>
      </svg>
    </button>
  </nav>
</header>

<script>
  function setupSearchButton() {
    document.getElementById('search-btn')?.addEventListener('click', () => {
      if ((window as any).openSearchModal) {
        (window as any).openSearchModal();
      }
    });
  }

  function setupThemeToggle() {
    const toggle = document.getElementById('theme-toggle');
    const sunIcon = document.getElementById('sun-icon');
    const moonIcon = document.getElementById('moon-icon');

    function updateIcons() {
      const isDark = document.documentElement.classList.contains('dark');
      sunIcon?.classList.toggle('hidden', isDark);
      moonIcon?.classList.toggle('hidden', !isDark);
    }

    toggle?.addEventListener('click', () => {
      const isDark = document.documentElement.classList.toggle('dark');
      localStorage.setItem('theme', isDark ? 'dark' : 'light');
      updateIcons();
    });

    updateIcons();
  }

  // 초기 로드
  setupSearchButton();
  setupThemeToggle();

  // ViewTransitions 페이지 전환 후
  document.addEventListener('astro:page-load', () => {
    setupSearchButton();
    setupThemeToggle();
  });
</script>

<style>
  .search-icon,
  .theme-icon {
    width: 1.25rem;
    height: 1.25rem;
  }
</style>
